<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyzing Results - DementiaDetect</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="processing-body">
    <div class="processing-container">
        <div class="processing-content">
            <div class="processing-header">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <span>DementiaDetect</span>
                </div>
            </div>

            <div class="processing-main">
                <div class="ai-animation">
                    <div class="brain-scan">
                        <div class="scan-line"></div>
                        <i class="fas fa-brain"></i>
                    </div>
                </div>

                <h2 class="processing-title">AI Analysis in Progress</h2>
                <p class="processing-subtitle">Our advanced algorithms are analyzing your cognitive patterns...</p>

                <div class="processing-steps">
                    <div class="step-item active" id="step1">
                        <div class="step-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <span class="step-text">Processing Assessment Data</span>
                        <div class="step-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                    
                    <div class="step-item" id="step2">
                        <div class="step-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <span class="step-text">Running AI Analysis</span>
                        <div class="step-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                    
                    <div class="step-item" id="step3">
                        <div class="step-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span class="step-text">Calculating Risk Factors</span>
                        <div class="step-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                    
                    <div class="step-item" id="step4">
                        <div class="step-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <span class="step-text">Generating Report</span>
                        <div class="step-check">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>

                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="analysisProgress"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>

                <div class="processing-info">
                    <div class="info-cards">
                        <div class="info-card">
                            <i class="fas fa-shield-alt"></i>
                            <span>Your data is secure and encrypted</span>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-clock"></i>
                            <span>Analysis typically takes 30-45 seconds</span>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-award"></i>
                            <span>95% accuracy with our AI model</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulate processing steps
        let currentStep = 0;
        const steps = ['step1', 'step2', 'step3', 'step4'];
        const stepTexts = [
            'Processing Assessment Data...',
            'Running AI Analysis...',
            'Calculating Risk Factors...',
            'Generating Report...'
        ];

        function simulateProcessing() {
            const progressBar = document.getElementById('analysisProgress');
            const progressText = document.getElementById('progressPercentage');
            let progress = 0;

            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;

                progressBar.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';

                // Activate steps based on progress
                if (progress > 25 && currentStep < 1) {
                    activateStep(1);
                } else if (progress > 50 && currentStep < 2) {
                    activateStep(2);
                } else if (progress > 75 && currentStep < 3) {
                    activateStep(3);
                } else if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        // Get assessment data from localStorage or URL params
                        const assessmentData = localStorage.getItem('assessmentData');
                        if (assessmentData) {
                            // Send to backend for prediction
                            submitToBackend(JSON.parse(assessmentData));
                        } else {
                            // Redirect to results with demo data
                            window.location.href = 'results.html?demo=true';
                        }
                    }, 1000);
                }
            }, 200);
        }

        function activateStep(stepIndex) {
            if (stepIndex <= currentStep) return;
            
            // Deactivate previous step
            if (currentStep >= 0) {
                const prevStep = document.getElementById(steps[currentStep]);
                prevStep.classList.remove('active');
                prevStep.classList.add('completed');
            }

            // Activate current step
            const currentStepEl = document.getElementById(steps[stepIndex]);
            currentStepEl.classList.add('active');
            
            currentStep = stepIndex;
        }

        async function submitToBackend(data) {
            try {
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                // Store results and redirect
                localStorage.setItem('predictionResult', JSON.stringify(result));
                window.location.href = 'results.html';
            } catch (error) {
                console.error('Error:', error);
                // Fallback to demo results
                window.location.href = 'results.html?demo=true&error=true';
            }
        }

        // Start processing simulation when page loads
        document.addEventListener('DOMContentLoaded', simulateProcessing);
    </script>
</body>
</html>
